dist: bionic
env:
  global:
    - DOCKER_COMPOSE_VERSION=1.25.3
services:
  - docker
addons:
  apt:
    packages:
      - docker-ce
      - expect-dev # for unbuffer: brings color back into travis logs

stages:
  - name: build / unit-testing
    if: tag IS blank
  - name: dependent build
    if: tag IS blank
  - name: integration-testing
    if: tag IS blank
  - name: system-testing
    if: tag IS blank
  - deployment

jobs:
  include:
    # build dy-2Dgraph images ----------------------------------------------------------------------
    - stage: dependent build
      # in pull request we do not have credentials to push, checks that the build still passes
      name: build dy-2Dgraph
      sudo: required
      before_install:
        - sudo bash ci/travis/build/dy-2Dgraph before_install
      install:
        - unbuffer bash ci/travis/build/dy-2Dgraph install
      before_script:
        - unbuffer bash ci/travis/build/dy-2Dgraph before_script
      script:
        - unbuffer bash ci/travis/build/dy-2Dgraph script
      after_success:
        - unbuffer bash ci/travis/build/dy-2Dgraph after_success
      after_failure:
        - unbuffer bash ci/travis/build/dy-2Dgraph after_failure
      deploy:
        - provider: script
          skip_cleanup: true
          script: unbuffer bash ci/travis/build/dy-2Dgraph deploy
          on:
            all_branches: true

notifications:
  email:
    on_success: never
    on_failure: always
