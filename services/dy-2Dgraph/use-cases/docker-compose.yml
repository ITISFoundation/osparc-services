version: "3.4"
services:
  kember:
    image: ${DOCKER_REGISTRY}/kember-viewer:${DOCKER_IMAGE_TAG}
    build:
      context: .
      dockerfile: kember/Dockerfile
      target: production
      args:
        BASE_IMAGE: ${BASE_IMAGE}
        NOTEBOOK_NAME: kember.ipynb
      labels:
        io.simcore.key: '{"key": "simcore/services/dynamic/kember-viewer"}'
        io.simcore.version: '{"version": "${DOCKER_IMAGE_TAG}"}'
        io.simcore.type: '{"type": "dynamic"}'
        io.simcore.name: '{"name": "kember-viewer"}'
        io.simcore.description: '{"description": "Graph viewer for data generated by kember solver"}'
        io.simcore.authors: '{"authors": [{"name": "Sylvain Anderegg", "email": "anderegg@itis.ethz.ch", "affiliation": "ITIS Foundation"}]}'
        io.simcore.contact: '{"contact": "anderegg@itis.ethz.ch"}'
        io.simcore.inputs: '{"inputs": {
          "outputController":{"label": "Input", "displayOrder":0, "description": "Input for postprocessing", "type": "data:*/*"}}}'
        io.simcore.outputs: '{"outputs": {
          "out_1": {"label": "Table Data", "displayOrder": 0, "description": "Table Data csv", "type": "data:text/csv"},
          "out_2": {"label": "Heart rate (r)", "displayOrder": 1, "description": "Heart rate (r) csv", "type": "data:text/csv"},
          "out_3": {"label": "Parasympathetic Cell Activity", "displayOrder": 2, "description": "Parasympathetic Cell Activity: Cardiac Level csv", "type": "data:text/csv"}}}'
        simcore.service.settings: '[
          {"name": "ports", "type": "int", "value": 8888},
          {"name": "constraints", "type": "string", "value": ["node.platform.os == linux"]}]'
        # simcore.service.bootsettings: '[
        #   {"name": "entry_point", "type": "string", "value": "?token=simcore"}]'
        org.label-schema.schema-version: "1.0"
        org.label-schema.build-date: "${BUILD_DATE}"
        org.label-schema.vcs-url: "${VCS_URL}"
        org.label-schema.vcs-ref: "${VCS_REF}"
    ports:
      - "1237:8888"
